<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AccVaults - Redeem Your Code</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .glass {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
        
        .input-field {
            background: rgba(255, 255, 255, 0.9);
            transition: all 0.3s ease;
        }
        
        .input-field:focus {
            background: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .success-animation {
            animation: successPulse 0.6s ease-in-out;
        }
        
        @keyframes successPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
    </style>
</head>
<body class="flex items-center justify-center p-4">
    <div class="w-full max-w-2xl">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-5xl font-bold text-white mb-2">
                <i class="fas fa-gem mr-3"></i>AccVaults
            </h1>
            <p class="text-white text-opacity-90 text-lg">Professional SMM Services</p>
        </div>

        <!-- Main Card -->
        <div class="glass rounded-2xl shadow-2xl p-8 mb-6">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">
                <i class="fas fa-ticket-alt mr-2"></i>Redeem Your Code
            </h2>

            <!-- Redemption Form -->
            <form id="redeemForm" class="space-y-6">
                <!-- Code Input -->
                <div>
                    <label class="block text-white font-medium mb-2">
                        <i class="fas fa-barcode mr-2"></i>Redemption Code
                    </label>
                    <input 
                        type="text" 
                        id="codeInput" 
                        class="input-field w-full px-4 py-3 rounded-lg border-0 focus:outline-none focus:ring-2 focus:ring-purple-500"
                        placeholder="XXXX-XXXX-XXXX-XXXX"
                        required
                    >
                    <p class="text-white text-opacity-70 text-sm mt-2">Enter your redemption code from your purchase</p>
                </div>

                <!-- Code Info Display (hidden initially) -->
                <div id="codeInfo" class="hidden bg-white bg-opacity-20 rounded-lg p-4 space-y-2">
                    <div class="flex items-center justify-between">
                        <span class="text-white font-medium"><i class="fas fa-box mr-2"></i>Platform:</span>
                        <span id="infoPlatform" class="text-white font-bold"></span>
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-white font-medium"><i class="fas fa-star mr-2"></i>Service:</span>
                        <span id="infoService" class="text-white font-bold"></span>
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-white font-medium"><i class="fas fa-hashtag mr-2"></i>Quantity:</span>
                        <span id="infoQuantity" class="text-white font-bold"></span>
                    </div>
                    <div id="infoRefill" class="hidden flex items-center justify-between">
                        <span class="text-white font-medium"><i class="fas fa-sync mr-2"></i>Refill:</span>
                        <span class="text-green-300 font-bold"><i class="fas fa-check-circle mr-1"></i>Available</span>
                    </div>
                    <div id="infoRequirements" class="hidden">
                        <span class="text-white font-medium"><i class="fas fa-info-circle mr-2"></i>Requirements:</span>
                        <p id="requirementsText" class="text-white text-opacity-90 text-sm mt-1"></p>
                    </div>
                </div>

                <!-- Link Input -->
                <div id="linkSection" class="hidden">
                    <label class="block text-white font-medium mb-2">
                        <i class="fas fa-link mr-2"></i>Your Link
                    </label>
                    <input 
                        type="url" 
                        id="linkInput" 
                        class="input-field w-full px-4 py-3 rounded-lg border-0 focus:outline-none focus:ring-2 focus:ring-purple-500"
                        placeholder="https://..."
                        required
                    >
                    <p id="linkHint" class="text-white text-opacity-70 text-sm mt-2">Enter the link where you want the service delivered</p>
                </div>

                <!-- Buttons -->
                <div class="flex gap-4">
                    <button 
                        type="button" 
                        id="validateBtn"
                        class="btn-primary flex-1 text-white font-semibold py-3 px-6 rounded-lg shadow-lg"
                    >
                        <i class="fas fa-check-circle mr-2"></i>Validate Code
                    </button>
                    <button 
                        type="submit" 
                        id="redeemBtn"
                        class="btn-primary flex-1 text-white font-semibold py-3 px-6 rounded-lg shadow-lg hidden"
                    >
                        <i class="fas fa-gift mr-2"></i>Redeem Now
                    </button>
                </div>
            </form>

            <!-- Alert Messages -->
            <div id="alertContainer" class="mt-6"></div>
        </div>

        <!-- Info Cards -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div class="glass rounded-lg p-4 text-center">
                <i class="fas fa-shield-alt text-white text-3xl mb-2"></i>
                <h3 class="text-white font-semibold">Secure</h3>
                <p class="text-white text-opacity-70 text-sm">Safe & encrypted</p>
            </div>
            <div class="glass rounded-lg p-4 text-center">
                <i class="fas fa-bolt text-white text-3xl mb-2"></i>
                <h3 class="text-white font-semibold">Instant</h3>
                <p class="text-white text-opacity-70 text-sm">Immediate delivery</p>
            </div>
            <div class="glass rounded-lg p-4 text-center">
                <i class="fas fa-headset text-white text-3xl mb-2"></i>
                <h3 class="text-white font-semibold">Support</h3>
                <p class="text-white text-opacity-70 text-sm">24/7 assistance</p>
            </div>
        </div>
    </div>

    <script>
        const codeInput = document.getElementById('codeInput');
        const linkInput = document.getElementById('linkInput');
        const validateBtn = document.getElementById('validateBtn');
        const redeemBtn = document.getElementById('redeemBtn');
        const codeInfo = document.getElementById('codeInfo');
        const linkSection = document.getElementById('linkSection');
        const alertContainer = document.getElementById('alertContainer');
        const redeemForm = document.getElementById('redeemForm');

        let validatedCode = null;

        // Auto-format code input
        codeInput.addEventListener('input', (e) => {
            let value = e.target.value.toUpperCase().replace(/[^A-Z0-9]/g, '');
            let formatted = value.match(/.{1,4}/g)?.join('-') || value;
            e.target.value = formatted;
        });

        // Validate code
        validateBtn.addEventListener('click', async () => {
            const code = codeInput.value.trim();
            
            if (!code) {
                showAlert('Please enter a code', 'error');
                return;
            }

            validateBtn.disabled = true;
            validateBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Validating...';

            try {
                const response = await fetch('/api/validate-code', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ code })
                });

                const data = await response.json();

                if (data.success) {
                    validatedCode = data.data;
                    showCodeInfo(data.data);
                    showAlert('Code validated successfully! Now enter your link.', 'success');
                    linkSection.classList.remove('hidden');
                    validateBtn.classList.add('hidden');
                    redeemBtn.classList.remove('hidden');
                    codeInput.disabled = true;
                } else {
                    showAlert(data.message, 'error');
                }
            } catch (error) {
                showAlert('Error validating code. Please try again.', 'error');
            } finally {
                validateBtn.disabled = false;
                validateBtn.innerHTML = '<i class="fas fa-check-circle mr-2"></i>Validate Code';
            }
        });

        // Redeem code
        redeemForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            const code = codeInput.value.trim();
            const link = linkInput.value.trim();

            if (!code || !link) {
                showAlert('Please fill in all fields', 'error');
                return;
            }

            redeemBtn.disabled = true;
            redeemBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Redeeming...';

            try {
                const response = await fetch('/api/redeem', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        code,
                        link,
                        user_id: 'web_' + Date.now(),
                        username: 'Web User'
                    })
                });

                const data = await response.json();

                if (data.success) {
                    showSuccessScreen(data.data);
                } else {
                    showAlert(data.message, 'error');
                    redeemBtn.disabled = false;
                    redeemBtn.innerHTML = '<i class="fas fa-gift mr-2"></i>Redeem Now';
                }
            } catch (error) {
                showAlert('Error redeeming code. Please try again.', 'error');
                redeemBtn.disabled = false;
                redeemBtn.innerHTML = '<i class="fas fa-gift mr-2"></i>Redeem Now';
            }
        });

        function showCodeInfo(data) {
            document.getElementById('infoPlatform').textContent = data.platform.toUpperCase();
            document.getElementById('infoService').textContent = data.service_type.toUpperCase();
            document.getElementById('infoQuantity').textContent = data.quantity.toLocaleString();
            
            if (data.has_refill) {
                document.getElementById('infoRefill').classList.remove('hidden');
            }

            if (data.requirements) {
                document.getElementById('requirementsText').textContent = data.requirements;
                document.getElementById('infoRequirements').classList.remove('hidden');
            }

            // Update link hint based on platform and service
            const hint = getLinkHint(data.platform, data.service_type);
            document.getElementById('linkHint').textContent = hint;

            codeInfo.classList.remove('hidden');
        }

        function getLinkHint(platform, serviceType) {
            const hints = {
                youtube: {
                    subscribers: 'Enter your YouTube channel URL (youtube.com/@username)',
                    views: 'Enter your YouTube video URL (youtube.com/watch?v=...)',
                    likes: 'Enter your YouTube video URL (youtube.com/watch?v=...)'
                },
                instagram: {
                    followers: 'Enter your Instagram profile URL (instagram.com/username)',
                    likes: 'Enter your Instagram post URL (instagram.com/p/...)',
                    views: 'Enter your Instagram post or reel URL'
                },
                tiktok: {
                    followers: 'Enter your TikTok profile URL (tiktok.com/@username)',
                    likes: 'Enter your TikTok video URL',
                    views: 'Enter your TikTok video URL'
                }
            };

            return hints[platform]?.[serviceType] || 'Enter the URL where you want the service delivered';
        }

        function showAlert(message, type) {
            const colors = {
                success: 'bg-green-500',
                error: 'bg-red-500',
                info: 'bg-blue-500'
            };

            const icons = {
                success: 'fa-check-circle',
                error: 'fa-exclamation-circle',
                info: 'fa-info-circle'
            };

            alertContainer.innerHTML = `
                <div class="${colors[type]} text-white px-6 py-4 rounded-lg shadow-lg flex items-center">
                    <i class="fas ${icons[type]} mr-3 text-xl"></i>
                    <span>${message}</span>
                </div>
            `;

            setTimeout(() => {
                alertContainer.innerHTML = '';
            }, 5000);
        }

        function showSuccessScreen(data) {
            document.querySelector('.glass').innerHTML = `
                <div class="text-center success-animation">
                    <div class="mb-6">
                        <i class="fas fa-check-circle text-green-400 text-7xl"></i>
                    </div>
                    <h2 class="text-3xl font-bold text-white mb-4">Code Redeemed Successfully!</h2>
                    <p class="text-white text-opacity-90 mb-6">Your order has been placed and is being processed.</p>
                    
                    <div class="bg-white bg-opacity-20 rounded-lg p-6 mb-6 text-left">
                        <h3 class="text-white font-bold mb-4 text-center">Order Details</h3>
                        <div class="space-y-3">
                            <div class="flex justify-between">
                                <span class="text-white font-medium">Order ID:</span>
                                <span class="text-white font-bold">#${data.order_id}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-white font-medium">Platform:</span>
                                <span class="text-white font-bold">${data.platform.toUpperCase()}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-white font-medium">Service:</span>
                                <span class="text-white font-bold">${data.service_type.toUpperCase()}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-white font-medium">Quantity:</span>
                                <span class="text-white font-bold">${data.quantity.toLocaleString()}</span>
                            </div>
                            ${data.has_refill ? `
                            <div class="flex justify-between">
                                <span class="text-white font-medium">Refill:</span>
                                <span class="text-green-300 font-bold"><i class="fas fa-check-circle mr-1"></i>Available</span>
                            </div>
                            ` : ''}
                        </div>
                    </div>

                    <div class="bg-blue-500 bg-opacity-30 rounded-lg p-4 mb-6">
                        <i class="fas fa-info-circle mr-2"></i>
                        <span class="text-white">Your order is being processed. Delivery typically takes a few minutes to hours depending on the service.</span>
                    </div>

                    <button onclick="location.reload()" class="btn-primary text-white font-semibold py-3 px-8 rounded-lg shadow-lg">
                        <i class="fas fa-redo mr-2"></i>Redeem Another Code
                    </button>
                </div>
            `;
        }
    </script>
</body>
</html>
